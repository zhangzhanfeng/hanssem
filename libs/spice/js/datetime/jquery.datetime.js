/**
 *
 * 日期控件
 * 详细用法请参考：http://v3.spice.lh/javascript/datetime
 * 如果链接无法访问，请联系QQ：1515110755 或 RTX：hong.liang
 *
 * @ author Razy
 * @ version 1.0
 *
 */
!function(a){"use strict";var b={format:"YYYY-MM-DD",min:"1900-01-01 00:00:00",max:"2099-12-31 23:59:59",init:!1,language:"zh_CN"},c={},d=document,e="createElement",f="getElementsByTagName",g=["datetime-box","datetime-void","datetime-click"],h=window;c.trim=function(a){return a=a||"",a.replace(/^\s|\s$/g,"").replace(/\s+/g," ")},c.digit=function(a){return a<10?"0"+(0|a):a},c.stopmp=function(a){return a=a||h.event,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,this},c.each=function(a,b){for(var c=0,d=a.length;c<d&&!1!==b(c,a[c]);c++);},c.hasClass=function(a,b){return a=a||{},new RegExp("\\b"+b+"\\b").test(a.className)},c.addClass=function(a,b){return a=a||{},c.hasClass(a,b)||(a.className+=" "+b),a.className=c.trim(a.className),this},c.removeClass=function(a,b){if(a=a||{},c.hasClass(a,b)){var d=new RegExp("\\b"+b+"\\b");a.className=a.className.replace(d,"")}return this},c.removeCssAttr=function(a,b){var c=a.style;c.removeProperty?c.removeProperty(b):c.removeAttribute(b)},c.shde=function(a,b){a.style.display=b?"none":"block"},c.query=function(a){if(a&&1===a.nodeType){if("input"!==a.tagName.toLowerCase())throw new Error("选择器elem错误");return a}var b,a=c.trim(a).split(" "),e=d.getElementById(a[0].substr(1));if(e){if(a[1]){if(/^\./.test(a[1])){var g,h=a[1].substr(1),i=new RegExp("\\b"+h+"\\b");return b=[],g=d.getElementsByClassName?e.getElementsByClassName(h):e[f]("*"),c.each(g,function(a,c){i.test(c.className)&&b.push(c)}),b[0]?b:""}return b=e[f](a[1]),b[0]?e[f](a[1]):""}return e}},c.on=function(a,b,d){return a.attachEvent?a.attachEvent("on"+b,function(){d.call(a,h.even)}):a.addEventListener(b,d,!1),c},c.stopMosup=function(b,d){(b!==a.spice.hasTouch?"touchend":"mouseup")&&c.on(d,a.spice.hasTouch?"touchend":"mouseup",function(a){c.stopmp(a)})},c.run=function(d){var e,f,h,j=(c.query,g.event);try{h=j.target||j.srcElement||{}}catch(a){h={}}e=d.elem?a(d.elem)[0]:h,g.elemv=/textarea|input/.test(e.tagName.toLocaleLowerCase())?"value":"innerHTML",("init"in d?d.init:b.init)&&!e[g.elemv]&&(e[g.elemv]=i.now(null,d.format||b.format)),f=d.event||"tap",c.each((0|e.length)>0?e:[e],function(b,e){c.stopMosup(f,e),a(e).off(f).on(f,function(a){c.stopmp(a),e!==c.elem&&(c.view(e,d),c.reshow())})})},c.scroll=function(a){return a=a?"scrollLeft":"scrollTop",d.body[a]|d.documentElement[a]},c.winarea=function(a){return document.documentElement[a?"clientWidth":"clientHeight"]},c.isleap=function(a){return a%4==0&&a%100!=0||a%400==0},c.checkVoid=function(a,b,d){var e=[];return a|=0,b|=0,d|=0,a<c.mins[0]?e=["y"]:a>c.maxs[0]?e=["y",1]:a>=c.mins[0]&&a<=c.maxs[0]&&(a==c.mins[0]&&(b<c.mins[1]?e=["m"]:b==c.mins[1]&&d<c.mins[2]&&(e=["d"])),a==c.maxs[0]&&(b>c.maxs[1]?e=["m",1]:b==c.maxs[1]&&d>c.maxs[2]&&(e=["d",1]))),e},c.timeVoid=function(a,b){if(c.ymd[1]+1==c.mins[1]&&c.ymd[2]==c.mins[2]){if(0===b&&a<c.mins[3])return 1;if(1===b&&a<c.mins[4])return 1;if(2===b&&a<c.mins[5])return 1}else if(c.ymd[1]+1==c.maxs[1]&&c.ymd[2]==c.maxs[2]){if(0===b&&a>c.maxs[3])return 1;if(1===b&&a>c.maxs[4])return 1;if(2===b&&a>c.maxs[5])return 1}if(a>(b?59:23))return 1},c.check=function(){var a=c.options.format.replace(/YYYY|MM|DD|hh|mm|ss/g,"\\d+\\").replace(/\\$/g,""),b=new RegExp(a),d=c.elem[g.elemv],e=d.match(/\d+/g)||[],f=c.checkVoid(e[0],e[1],e[2]);if(""!==d.replace(/\s/g,"")){if(!b.test(d))return c.elem[g.elemv]="",1;if(f[0])return c.elem[g.elemv]="",1;f.value=c.elem[g.elemv].match(b).join(),e=f.value.match(/\d+/g),e[1]<1?(e[1]=1,f.auto=1):e[1]>12?(e[1]=12,f.auto=1):e[1].length<2&&(f.auto=1),e[2]<1?(e[2]=1,f.auto=1):e[2]>c.months[(0|e[1])-1]?(e[2]=31,f.auto=1):e[2].length<2&&(f.auto=1),e.length>3&&(c.timeVoid(e[3],0)&&(f.auto=1),c.timeVoid(e[4],1)&&(f.auto=1),c.timeVoid(e[5],2)&&(f.auto=1)),f.auto?c.creation([e[0],0|e[1],0|e[2]],1):f.value!==c.elem[g.elemv]&&(c.elem[g.elemv]=f.value)}},c.months=[31,null,31,30,31,30,31,31,30,31,30,31],c.viewDate=function(a,b,d){var e=(c.query,{}),f=new Date;a<(0|c.mins[0])&&(a=0|c.mins[0]),a>(0|c.maxs[0])&&(a=0|c.maxs[0]),f.setFullYear(a,b,d),e.ymd=[f.getFullYear(),f.getMonth(),f.getDate()],c.months[1]=c.isleap(e.ymd[0])?29:28,f.setFullYear(e.ymd[0],e.ymd[1],1),e.FDay=f.getDay(),e.PDay=c.months[0===b?11:b-1]-e.FDay+1,e.NDay=1,c.each(g.tds,function(a,b){var d,f=e.ymd[0],h=e.ymd[1]+1;b.className="",a<e.FDay?(b.innerHTML=d=a+e.PDay,c.addClass(b,"datetime-nothis"),1===h&&(f-=1),h=1===h?12:h-1):a>=e.FDay&&a<e.FDay+c.months[e.ymd[1]]?(b.innerHTML=d=a-e.FDay+1,a-e.FDay+1===e.ymd[2]&&(c.addClass(b,g[2]),e.thisDay=b)):(b.innerHTML=d=e.NDay++,c.addClass(b,"datetime-nothis"),12===h&&(f+=1),h=12===h?1:h+1),c.checkVoid(f,h,d)[0]&&c.addClass(b,g[1]),b.setAttribute("y",f),b.setAttribute("m",h),b.setAttribute("d",d),f=h=d=null}),c.valid=!c.hasClass(e.thisDay,g[1]),c.ymd=e.ymd,g.year.innerHTML=c.ymd[0],g.month.innerHTML=c.options.language.months[c.ymd[1]],c.each(g.mms,function(a,b){var d=c.checkVoid(c.ymd[0],1+(0|b.getAttribute("m")));"y"===d[0]||"m"===d[0]?c.addClass(b,g[1]):c.removeClass(b,g[1]),c.removeClass(b,g[2]),d=null}),c.addClass(g.mms[c.ymd[1]],g[2]),e.times=[0|c.inymd[3]||0,0|c.inymd[4]||0,0|c.inymd[5]||0],c.each(new Array(3),function(a){c.hmsin[a].innerHTML=c.digit(c.timeVoid(e.times[a],a)?0|c.mins[a+3]:0|e.times[a])}),c[c.valid?"removeClass":"addClass"](g.ok,g[1])},c.viewYears=function(a){var b=c.query,d="";c.each(new Array(14),function(b){d+=7===b?"<li "+(parseInt(g.year.innerHTML)===a?'class="'+g[2]+'"':"")+' y="'+a+'">'+a+"</li>":'<li y="'+(a-7+b)+'">'+(a-7+b)+"</li>"}),b("#datetime-ys").innerHTML=d,c.each(b("#datetime-ys li"),function(a,b){"y"===c.checkVoid(b.getAttribute("y"))[0]?c.addClass(b,g[1]):c.on(b,"click",function(a){c.stopmp(a).reshow(),c.viewDate(0|this.getAttribute("y"),c.ymd[1],c.ymd[2])})})},c.initDate=function(){var a=(c.query,new Date),b=c.elem[g.elemv].match(/\d+/g)||[];b.length<3&&(b=c.options.start.match(/\d+/g)||[],b.length<3&&(b=[a.getFullYear(),a.getMonth()+1,a.getDate()])),c.inymd=b,c.viewDate(b[0],b[1]-1,b[2])},c.iswrite=function(){var a=c.query,b={time:a("#datetime-hms")};c.shde(b.time,!c.options.istime),c.shde(g.oclear,!("isclear"in c.options?c.options.isclear:1)),c.shde(g.otoday,!("istoday"in c.options?c.options.istoday:1)),c.shde(g.ok,!("issure"in c.options?c.options.issure:1))},c.orien=function(a,b){var d,e=c.elem.getBoundingClientRect();a.style.left=e.left+(b?0:c.scroll(1))+"px",d=e.bottom+a.offsetHeight/1.5<=c.winarea()?e.bottom-1:e.top>a.offsetHeight/1.5?e.top-a.offsetHeight+1:c.winarea()-a.offsetHeight,a.style.top=Math.max(d+(b?0:c.scroll()),1)+"px"},c.follow=function(a){c.options.fixed?(a.style.position="fixed",c.orien(a,1)):(a.style.position="absolute",c.orien(a))},c.viewtbHTML="",c.viewtb=function(){var a,b=[],g=c.options.language.daysMin,h={},i=d[e]("table"),j=d[e]("thead");return j.appendChild(d[e]("tr")),h.creath=function(a){var b=d[e]("th");b.innerHTML=g[a],j[f]("tr")[0].appendChild(b),b=null},c.each(new Array(6),function(d){b.push([]),a=i.insertRow(0),c.each(new Array(7),function(c){b[d][c]=0,0===d&&h.creath(c),a.insertCell(c)})}),i.insertBefore(j,i.children[0]),i.id=i.className="datetime-table",a=b=null,i.outerHTML.toLowerCase()},c.view=function(f,h){var i,j=c.query,k={};h=h||f,c.elem=f,c.options=h,c.options.format||(c.options.format=b.format),c.options.start=c.options.start||"",c.mm=k.mm=[c.options.min||b.min,c.options.max||b.max],c.mins=k.mm[0].match(/\d+/g),c.maxs=k.mm[1].match(/\d+/g),c.viewtbHTML=c.viewtb(),a("#"+g[0]).remove(),i=d[e]("div"),i.id=g[0],i.className=g[0],i.style.cssText="position: absolute;",i.innerHTML=k.html='<div class="datetime-top"><div class="datetime-ym datetime-y" id="datetime-YY"><a class="datetime-choose datetime-chprev datetime-tab"><cite></cite></a><span id="datetime-y"></span><label></label><a class="datetime-choose datetime-chnext datetime-tab"><cite></cite></a><div class="datetime-yms"><a class="datetime-tab datetime-chtop"><cite></cite></a><ul id="datetime-ys"></ul><a class="datetime-tab datetime-chdown"><cite></cite></a></div></div><div class="datetime-ym datetime-m" id="datetime-MM"><a class="datetime-choose datetime-chprev datetime-tab"><cite></cite></a><span id="datetime-m"></span><label></label><a class="datetime-choose datetime-chnext datetime-tab"><cite></cite></a><div class="datetime-yms" id="datetime-ms">'+function(){var a="",b=c.options.language.months;return c.each(b,function(c){a+='<span m="'+c+'">'+b[c]+"</span>"}),a}()+"</div></div></div>"+c.viewtbHTML+'<div class="datetime-bottom"><ul id="datetime-hms"><li class="datetime-sj">'+c.options.language.time+'</li><li><span></span>:</li><li><span></span>:</li><li><span></span></li></ul><div class="datetime-time" id="datetime-time"></div><div class="datetime-btn"><a id="datetime-clear">'+c.options.language.clear+'</a><a id="datetime-today">'+c.options.language.today+'</a><a id="datetime-ok">'+c.options.language.confirm+"</a></div></div>",d.body.appendChild(i),c.box=j("#"+g[0]),c.events(),i=null,c.follow(c.box),h.zIndex?c.box.style.zIndex=h.zIndex:c.removeCssAttr(c.box,"z-index"),c.stopMosup("click",c.box),c.initDate(),c.iswrite(),c.check()},c.reshow=function(){return c.each(c.query("#"+g[0]+" .datetime-show"),function(a,b){c.removeClass(b,"datetime-show")}),this},c.close=function(){c.reshow(),c.shde(c.query("#"+g[0]),1),c.elem.blur(),c.elem=null},c.parse=function(a,d,e){return a=a.concat(d),e=e||(c.options?c.options.format:b.format),e.replace(/YYYY|MM|DD|hh|mm|ss/g,function(b,d){return a.index=0|++a.index,c.digit(a[a.index])})},c.creation=function(a,b){var d=(c.query,c.hmsin),e=c.parse(a,[d[0].innerHTML,d[1].innerHTML,d[2].innerHTML]);c.elem[g.elemv]=e,b||(c.close(),"function"==typeof c.options.choose&&c.options.choose(e))},c.events=function(){var b=c.query,e={box:"#"+g[0]};c.addClass(d.body,"datetime-body"),g.tds=b("#datetime-table td"),g.mms=b("#datetime-ms span"),g.year=b("#datetime-y"),g.month=b("#datetime-m"),c.each(b(e.box+" .datetime-ym"),function(a,b){c.on(b,"click",function(b){c.stopmp(b).reshow(),c.addClass(this[f]("div")[0],"datetime-show"),a||(e.YY=parseInt(g.year.innerHTML),c.viewYears(e.YY))})}),c.on(b(e.box),"click",function(){c.reshow()}),e.tabYear=function(a){0===a?c.ymd[0]--:1===a?c.ymd[0]++:2===a?e.YY-=14:e.YY+=14,a<2?(c.viewDate(c.ymd[0],c.ymd[1],c.ymd[2]),c.reshow()):c.viewYears(e.YY)},c.each(b("#datetime-YY .datetime-tab"),function(a,b){c.on(b,"click",function(b){c.stopmp(b),e.tabYear(a)})}),e.tabMonth=function(a){a?12===++c.ymd[1]&&(c.ymd[0]++,c.ymd[1]=0):-1===--c.ymd[1]&&(c.ymd[0]--,c.ymd[1]=11),c.viewDate(c.ymd[0],c.ymd[1],c.ymd[2])},c.each(b("#datetime-MM .datetime-tab"),function(a,b){c.on(b,"click",function(b){c.stopmp(b).reshow(),e.tabMonth(a)})}),c.each(b("#datetime-ms span"),function(a,b){c.on(b,"click",function(a){c.stopmp(a).reshow(),c.hasClass(this,g[1])||c.viewDate(c.ymd[0],0|this.getAttribute("m"),c.ymd[2])})}),c.each(b("#datetime-table td"),function(a,b){c.on(b,"click",function(a){c.hasClass(this,g[1])||(c.stopmp(a),c.creation([0|this.getAttribute("y"),0|this.getAttribute("m"),0|this.getAttribute("d")]))})}),g.oclear=b("#datetime-clear"),c.on(g.oclear,"click",function(){c.elem[g.elemv]="",c.close(),"function"==typeof c.options.choose&&c.options.choose()}),g.otoday=b("#datetime-today"),c.on(g.otoday,"click",function(){var a=new Date;c.creation([a.getFullYear(),a.getMonth()+1,a.getDate()])}),g.ok=b("#datetime-ok"),c.on(g.ok,"click",function(){c.valid&&c.creation([c.ymd[0],c.ymd[1]+1,c.ymd[2]])}),e.times=b("#datetime-time"),c.hmsin=e.hmsin=b("#datetime-hms span"),e.hmss=[c.options.language.hour,c.options.language.minute,c.options.language.seconds],e.hmsarr=[],c.msg=function(a,d){var f='<div class="datetime-hsmtex">'+d+"<span>×</span></div>";"string"==typeof a?(f+="<p>"+a+"</p>",c.shde(b("#"+g[0])),c.removeClass(e.times,"datetime-time1").addClass(e.times,"datetime-msg")):(e.hmsarr[a]?f=e.hmsarr[a]:(f+='<div id="datetime-hmsno" class="datetime-hmsno">',c.each(new Array(0===a?24:60),function(a){f+="<span>"+a+"</span>"}),f+="</div>",e.hmsarr[a]=f),c.removeClass(e.times,"datetime-msg"),c[0===a?"removeClass":"addClass"](e.times,"datetime-time1")),c.addClass(e.times,"datetime-show"),e.times.innerHTML=f},e.hmson=function(a,d){var e=b("#datetime-hmsno span"),f=c.valid?null:1;c.each(e,function(b,e){f?c.addClass(e,g[1]):c.timeVoid(b,d)?c.addClass(e,g[1]):c.on(e,"click",function(b){c.hasClass(this,g[1])||(a.innerHTML=c.digit(0|this.innerHTML))})}),c.addClass(e[0|a.value],"datetime-click")},c.each(e.hmsin,function(a,b){c.on(b,"click",function(b){c.stopmp(b).reshow(),c.msg(a,e.hmss[a]),e.hmson(this,a)})}),c.on(d,a.spice.hasTouch?"touchend":"mouseup",function(){var a=b("#"+g[0]);a&&"none"!==a.style.display&&(c.check()||c.close())}).on(d,"keydown",function(a){a=a||h.event,13===a.keyCode&&c.elem&&c.creation([c.ymd[0],c.ymd[1]+1,c.ymd[2]])})};var i=function(a){a=a||{};try{g.event=h.event?h.event:i.caller.arguments[0]}catch(a){}return c.run(a),i};i.reset=function(){c.box&&c.elem&&c.follow(c.box)},i.now=function(a,b){var d=new Date(0|a?function(a){return a<864e5?+new Date+864e5*a:a}(parseInt(a)):+new Date);return c.parse([d.getFullYear(),d.getMonth()+1,d.getDate()],[d.getHours(),d.getMinutes(),d.getSeconds()],b)},a.spice.datetime=function(b,c){if(!b||a.isPlainObject(b))return!1;c||(c={});var d=c.language;d?"string"==a.type(d)&&(c.language=a.spice.datetime.dates[d]):(d="zh_CN",c.language=a.spice.datetime.dates[d]),a.each(a(b),function(b,d){a(d).data("spice.datetime",i(a.extend({},{elem:d},c)))})},a.spice.datetime.dates={}}(jQuery);