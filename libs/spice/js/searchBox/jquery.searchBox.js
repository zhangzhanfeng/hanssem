!function(a){"use strict";function b(b,c){if(!b||a.isPlainObject(b))return!1;var d=[];return a(b).each(function(b,f){var g=a(f),h=g.data("spice.SearchBox");h&&h.destroy(),g.data("spice.SearchBox",h=new e(g,c)),d.push(h)}),d}var c={url:"",queryKey:"",searchUrl:"/?search=",checkData:null,inputClass:"form-input-searchbox",submenuClass:"sub-menu-searchbox",ulClass:"sub-menu-ul-searchbox",btnClass:"link-btn-searchbox",activeClass:"selected",datahref:"data-href",tinyscrollbarCallBack:null,tinyscrollbarConfig:{},customScroll:null,isIscroll:!1},d={setMenu:function(b,c,e){var f=(e.elem,e.opt),g=c,h=a(b);e.elem.find("."+f.ulClass).html(h),g.find("li").on("tap",function(){var b=a(this),c=a.trim(b.find("a").text()),h=b.attr(f.datahref),i=e.elem.find("."+f.inputClass);g.hide(),i.val(c),d.linkJump(h,e)}),g.show()},setLi:function(a,b){for(var c=[],d=a.search,e=0;e<d.length;e++)c.push("<li "+b.opt.datahref+"="+d[e].keyword+" ><a>"+d[e].text+"</a></li>");return c.join("")},hideMenu:function(a){var b=a.elem.find("."+a.opt.submenuClass);!b.is("select")&&b.hide()},showMenu:function(a,b){var c=a,d=b.elem.find("."+b.opt.submenuClass);if(d.find("li").length>0)d.show();else{var e=c.val(),f=c.attr("placeholder");""!=e&&e!=f&&c.trigger("keyup.SearchBox")}},linkJump:function(a,b){a&&(window.location.href=b.opt.searchUrl+a)}},e=function(b,d){var e=this;e.opt=a.extend({},c,d),e.elem=b,e.init()};e.prototype={init:function(){var b=this,c=b.elem,e=b.opt,f=c.find("."+e.inputClass),g=(c.find("."+e.submenuClass),c.find("."+e.btnClass));f.on("keyup.SearchBox",function(f){var g=a(this),h=f.keyCode,i=g.val(),j=b.elem.find("."+b.opt.submenuClass);j.find("li"),b.elem.find("."+b.opt.inputClass);if(""==i)d.hideMenu(b);else if(13==h){d.hideMenu(b);var k=j.find("."+b.opt.activeClass);k.length>0&&g.val(a.trim(k.find("a").text()));var l=k.attr(b.opt.datahref),m=l||g.val();d.linkJump(m,b)}else if(37!=h&&38!=h&&39!=h&&40!=h&&9!=h){var n={};if(n[e.queryKey]=i,!b.opt.url||!b.opt.queryKey)return!1;var o="",p=a.spice.syncXhr(b.opt.url,n);if(!p)return d.hideMenu(b),!1;o=e.checkData&&a.isFunction(e.checkData)?e.checkData(p,b):"object"==typeof p?d.setLi(p,b):p,d.setMenu(o,j,b);var q=e.tinyscrollbarConfig,r=e.customScroll;r?a.isFunction(r)&&r($self):(q.callBack||(q.callBack=function(b){e.tinyscrollbarCallBack&&a.isFunction(e.tinyscrollbarCallBack)&&e.tinyscrollbarCallBack($self,b)}),a.spice.tools.tinyscrollbar({elem:a(".tinyscrollbar",c),options:q,isIscroll:e.isIscroll}))}}),f.on("keydown.SearchBox",function(a){var c=a.keyCode,d=b.elem.find("."+b.opt.submenuClass),e=d.find("li"),f=d.find("li."+b.opt.activeClass);e.length;if(40==c){var g=f.next();f=0==g.length?e.eq(0):g,e.removeClass(b.opt.activeClass),f.addClass(b.opt.activeClass);var h=e.eq(0).innerHeight(),i=Math.abs(parseInt(d.find(".overview").css("marginTop"))),j=h*(e.index(f)+1)-i,k=d.find(".viewport").height();0==g.length?d.data("spice.tinyscrollbar")&&d.data("spice.tinyscrollbar").update(0):j-k>0&&d.data("spice.tinyscrollbar")&&d.data("spice.tinyscrollbar").update(j-k+i)}if(38==c){var l=f.prev();f=0==l.length?e.eq(-1):l,e.removeClass(b.opt.activeClass),f.addClass(b.opt.activeClass);var h=e.eq(0).innerHeight(),i=Math.abs(parseInt(d.find(".overview").css("marginTop"))),j=h*e.index(f),k=d.find(".viewport").height();0==l.length?d.data("spice.tinyscrollbar")&&d.data("spice.tinyscrollbar").update(d.find(".overview").height()-k):i-j>0&&d.data("spice.tinyscrollbar")&&d.data("spice.tinyscrollbar").update(j)}}),a(document).on("tap.SearchBox",function(c){var e=a(c.target);0==e.closest("."+b.opt.submenuClass).length&&0==e.closest("."+b.opt.inputClass).length&&d.hideMenu(b)}),f.on("focus.SearchBox",function(){d.showMenu(a(this),b)}),g.on("tap.SearchBox",function(){var a=b.elem.find("."+e.inputClass);d.linkJump(a.val(),b)})},destroy:function(){var b=this,c=b.elem,d=b.opt,e=c.find("."+d.inputClass),f=c.find("."+d.btnClass);b.elem.removeData("spice.SearchBox"),e.off("keyup.SearchBox").off("keydown.SearchBox").off("focus.SearchBox"),f.off("tap.SearchBox"),a(document).off("tap.SearchBox")}},a.spice.SearchBox=b}(jQuery);