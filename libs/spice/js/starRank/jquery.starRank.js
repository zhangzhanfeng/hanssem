!function(a){"use strict";function b(b,c){if(!b||a.isPlainObject(b))return!1;var d=[];return a(b).each(function(b,f){var g=a(f),h=g.data("spice.StarRank");h&&h.destroy(),g.data("spice.StarRank",h=new e(g,c)),d.push(h)}),d}var c={rankLen:5,hasHalf:!1,hasHover:!0,defaultRank:null,message:null,messageClass:".help-block",callBack:null,isDefaultCallBack:!0},d={getIndex:function(a,b,c,d){var e,f=c,g=b,h=d,i=h-c.offset().left;return e=a.opt.hasHalf?i>f.width()/2?1:.5:1,g.index(f)+e},setClass:function(a,b){var c=b%1>0?(b+.5).toString()+"-1":b,d=b%1>0?b+.5:b;a.removeClass().filter(":lt("+d+")").addClass("rank"+c),b%1>0?(a.removeClass().filter(":lt("+(b-.5)+")").addClass("rank"+(b+.5)),a.eq(b-.5).addClass("rank"+(b+.5)+"-1")):a.removeClass().filter(":lt("+b+")").addClass("rank"+b)},checkMessage:function(b){var c=b.opt.message,d=b.opt.rankLen,e=!1;if(a.isArray(c)&&c.length==d+1){e=!0;for(var f=1;f<c.length;f++)if(!c[f])return e=!1}return"string"==a.type(c)&&(e=!0),e},checkRank:function(b,c){var d=!1;if(a.isArray(b)&&b.length==c.length){d=!0;for(var e=0;e<b.length;e++)if(!b[e]&&""!=b[e])return d=!1}return d},setMessage:function(b,c,d){var e=b.opt.message,f=b.opt.messageClass,g=c.find(f),h=d%1>0?d+.5:d;"string"==a.type(e)?g.html(e):g.html(e[h])},setLiRank:function(a,b){a.data({"spice.StarRank.rank":b})},getLiRank:function(a){return a.data("spice.StarRank.rank")},defaultInit:function(b,c){var e=b.elem.find("li"),f=(b.opt,0),g=d.checkRank(b.opt.defaultRank,e);e.each(function(e,h){var i=a(h),j=i.find(".rankBox>a");g&&(f=b.opt.defaultRank[e]),!f&&(f=0),d.setLiRank(i,f),d.setClass(j,f),c&&d.setMessage(b,i,f),b.li=i,b.index=f,b.opt.isDefaultCallBack&&a(b.elem).trigger("StarRank.init",b)})}},e=function(b,d){var e=this;e.opt=a.extend({},c,d),e.elem=b,e.init()};e.prototype={init:function(){for(var b=this,c=b.opt,e=b.opt.rankLen,f=d.checkMessage(b),g=a.spice.hasTouch,h=g?"touchend.kvScroll":"mouseup.kvScroll",i=b.elem.find(".rankBox"),j=[],k=0;k<e;k++)j.push("<a></a>");i.append(j.join("")),d.defaultInit(b,f),c.hasHover&&!g&&a(">a",i).on({"mousemove.StarRank":function(c){var e,g=a(this),h=g.closest("li"),i=h.find(".rankBox>a"),j=a.spice.getEventXY(c).x;e=d.getIndex(b,i,g,j),d.setClass(i,e),f&&d.setMessage(b,h,e),b.li=h,b.index=e,a(b.elem).trigger("StarRank.mousemove",b)},"mouseleave.StarRank":function(c){var e=a(this),g=e.closest("li"),h=g.find(".rankBox>a"),i=d.getLiRank(g);d.setClass(h,i),f&&d.setMessage(b,g,i),b.li=g,b.index=i,a(b.elem).trigger("StarRank.mouseleave",b)}}),a(">a",i).on(h,function(c){var e,g=a(this),h=g.closest("li"),i=h.find(".rankBox>a"),j=a.spice.getEventXY(c).x;e=d.getIndex(b,i,g,j),d.setClass(i,e),d.setLiRank(h,e),f&&d.setMessage(b,h,e),b.li=h,b.index=e,a(b.elem).trigger("StarRank.tap",b)})},getRank:function(){var b=this,c=b.elem.find("li"),d=[];return c.each(function(b,c){var e=a(this).data("spice.StarRank.rank");d.push(e)}),d},setRank:function(b){var c=b,e=this,f=(e.opt,e.elem.find("li")),g=d.checkMessage(e);d.checkRank(c,f)&&f.each(function(b,f){var h=a(f),i=h.find(".rankBox>a"),j=c[b];!j&&(j=0),d.setLiRank(h,j),d.setClass(i,j),g&&d.setMessage(e,h,j),e.li=h,e.index=j,a(e.elem).trigger("StarRank.init",e)})},destroy:function(){var a=this;a.opt;a.elem.removeData("spice.StarRank").find("li").removeData("spice.StarRank.rank").find(".rankBox").html("")}},a.spice.StarRank=b}(jQuery);