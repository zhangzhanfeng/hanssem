/**
 *
 * 插件模版
 * 详细用法请参考：http://xxxx/
 *
 * @ author
 * @ version
 *
 */
!function(a){"use strict";function b(b,c){if(!b||a.isPlainObject(b))return!1;var e=[];return a(b).each(function(b,f){var g=a(f),h=g.data("spice.moveCenter");h&&h.destroy(),g.data("spice.moveCenter",h=new d(g,c)),e.push(h)}),e}var c={infinite:!1,number:3,equalHeight:!0,prevOrNot:!1,nextOrNot:!1,dragOrNot:!0,time:700,tabClass:"is-active",scrollNumber:1,disScale:.615,minScale:.5,moveDis:100,notSetSize:!1,setSize:function(b,c,d){if(a.browser.msie&&a.browser.version<=8){var e=b.find("a");e.css("width",100*c+"%"),e.css("marginTop",(d.height()-e.height())/2),e.css("opacity",c)}else{var e=b.find("a");e.css("transform","scale("+c+")"),e.css("opacity",c)}}},d=function(b,d){var e=this;this.elem=b;var f=a.extend({},c,d);a.each(f,function(a,b){e[a]=b}),this.init()};d.prototype={init:function(){var b=this;this.oWrapper=this.elem,this.str=this.oWrapper.html(),this.prevOrNot&&this.oWrapper.append('<div class="scroll-btn scroll-btn-prev"><a><i>&lt;</i></a></div>'),this.nextOrNot&&this.oWrapper.append('<div class="scroll-btn scroll-btn-next"><a><i>&gt;</i></a></div>'),this.oWrapperInner=a(".scroller-wrap",this.oWrapper),this.oLeft=a(".scroll-btn-prev",this.oWrapper),this.oRight=a(".scroll-btn-next",this.oWrapper),this.oUl=a(this.oWrapperInner).children("ul"),this.maxSize=this.minScale,this.speed=0,this.scale=1,this.originScaleWidth=this.minScale,this.originScaleWidthFarther=this.minScale,this.timer=null,this.bOk=!0,this.oldMoveClientX=0,this.originScaleWidthData=!0,this.originScaleWidthFartherData=!0,this.initData=!0,this.originCount=0,this.dis=0,this.downDis=0,this.imgLoadCount=0,this.infinite?(this.oUl.html(this.oUl.html()+this.oUl.html()+this.oUl.html()),this.aLi=this.oUl.children(),this.count=this.aLi.length/3+(this.number-1)/2):(this.aLi=this.oUl.children(),this.count=(this.number-1)/2),this.scrollNumber>this.number&&(this.scrollNumber=this.number),this.infinite&&this.number>this.aLi.length/3&&console.log("轮播内容个数必须大于整屏放置的number数量,多图轮播可能出问题"),this._browserRedirect(),this.aLi.find("img").each(function(c,d){d.complete?++b.imgLoadCount==b.aLi.find("img").length&&b._init():a(d).load(function(){++b.imgLoadCount==b.aLi.find("img").length&&b._init()})})},prev:function(){this._leftClick()},next:function(){this._rightClick()},scroll:function(b,c){if(this.scale=1,this.infinite){if(b<1||b>this.aLi.length/3)return void console.log("不在滚动的区间")}else if(b<1||b>this.aLi.length)return void console.log("不在滚动的区间");if(0==c)return this.infinite?this.count=this.aLi.length/3+b-1:this.count=b-1,void this._setBok();if(this.scrollTime=c||this.time,this.infinite){if(b-1==this.count-this.aLi.length/3)return;if(this._confirmCount(),a.browser.msie&&a.browser.version<=8)var d=(this.count-b+1-this.aLi.length/3)*this._getStyle(this.aLi)*this._getStyle(this.oUl)/100;else var d=(this.count-b+1-this.aLi.length/3)*this.oWrapperInner.width()/this.number}else{if(b-1==this.count)return;if(a.browser.msie&&a.browser.version<=8)var d=(this.count-b+1)*this._getStyle(this.aLi)*this._getStyle(this.oUl)/100;else var d=(this.count-b+1)*this.oWrapperInner.width()/this.number}this._move(this.oldLeft,d,this.scrollTime,"linear")},destroy:function(){this.oWrapper.html(this.str),this.prevOrNot&&this._removePrev(),this.nextOrNot&&this._removeNext(),this.dragOrNot&&this._removeDrag()},_addDrag:function(){var a=this;this.mobile?this.oUl.on("touchstart.drag",function(b){a._drag(b)}):this.oUl.on("mousedown.drag",function(b){a._drag(b)})},_removeDrag:function(){this.mobile?this.oUl.off("touchstart.drag"):this.oUl.off("mousedown.drag")},_addNext:function(){var a=this;this.mobile?this.oRight.on("touchstart.next",function(){a._rightClick()}):this.oRight.on("click.next",function(){a._rightClick()})},_removeNext:function(){this.mobile?this.oRight.off("touchstart.next"):this.oRight.off("click.next")},_addPrev:function(){var a=this;this.mobile?this.oLeft.on("touchstart.prev",function(){a._leftClick()}):this.oLeft.on("click.prev",function(){a._leftClick()})},_removePrev:function(){this.mobile?this.oLeft.off("touchstart.prev"):this.oLeft.off("click.prev")},_init:function(){var b=this;a.browser.msie&&a.browser.version<=8?(this.oUl.css("width",100*this.aLi.length/this.number+"%"),this.aLi.css("width",100/this.aLi.length+"%")):this._setWidth(),a.browser.msie&&a.browser.version<=8?(this.oUl.css("height",this.aLi.eq(this.count).height()),this._setCenter(this.count),this._setSize()):this._setResize(),b.equalHeight&&b.number>=5&&!this.notSetSize&&b._setSize(),a.browser.msie&&a.browser.version<=8?(this.resizeTimer=null,a(window).off("resize.movecenter").on("resize.movecenter",function(){b.resizeTimer&&clearTimeout(b.resizeTimer),b.resizeTimer=setTimeout(function(){b.notSetSize?b.oUl.css("height",b.aLi.eq(b.count).height()):b._setResize()},150)})):a(window).on("resize.movecenter",function(){b._setResize()}),this.prevOrNot&&this._addPrev(),this.nextOrNot&&this._addNext(),this.dragOrNot&&this._addDrag()},_setResize:function(){a.browser.msie&&a.browser.version<=8?this.notSetSize?this.oUl.css("height",this.aLi.eq(this.count).height()):(this.oUl.css("height",this.aLi.eq(this.count).height()),this._setCenter(this.count),this._setSize()):(this._setWidth(),this._setCenter(this.count),this._setSize(),(a.browser.msie&&a.browser.version>8||-1!=navigator.userAgent.indexOf("Trident")&&-1!=navigator.userAgent.indexOf("rv"))&&(this._setWidth(),this._setCenter(this.count)))},_setWidth:function(){a.browser.msie&&a.browser.version<=8||(this.aLi.css("width",this.oWrapperInner.width()/this.number),this.oUl.css("width",(this.aLi.width()+1)*this.aLi.length))},_setCenter:function(b){if(a.browser.msie&&a.browser.version<=8)return this.oldLeft=50-(b+.5)*this._getStyle(this.aLi)*this._getStyle(this.oUl)/100,void this.oUl.css("left",this.oldLeft+"%");this.oldLeft=(.5-(b+.5)/this.number)*this.oWrapperInner.width(),this.oUl.css("left",this.oldLeft)},_setSize:function(){var b=this;this._setMaxSize(),this.aLi.each(function(c,d){var e=Math.abs(b.oUl.position().left+a(d).position().left+a(d).width()/2-b.oWrapperInner.width()/2),f=1-e/(b.oWrapperInner.width()*b.disScale);b.equalHeight?f<b.originScaleWidth&&(f=b.originScaleWidth):f<b.originScaleWidthFarther&&(f=b.originScaleWidthFarther),b.initData||f>b.maxSize&&(b.maxSize=f,b.count=c),b.count+1==c&&f>b.originScaleWidth&&b.originScaleWidthData&&(b.originScaleWidth=f,b.originScaleWidthData=!1),b.number>=5&&!b.equalHeight&&b.count+2==c&&f>b.originScaleWidthFarther&&b.originScaleWidthFartherData&&(b.originScaleWidthFarther=f,b.originScaleWidthFartherData=!1),c==b.aLi.length-1&&(b.initData=!1,b.originScaleWidthData=!1,b.originScaleWidthFartherData=!1),b.setSize(a(b.aLi[c]),f,b.oUl)}),this.aLi.eq(this.count).addClass(this.tabClass).siblings().removeClass(this.tabClass)},_centerUl:function(b){if(a.browser.msie&&a.browser.version<=8)var c=50-(this.count+.5)*this._getStyle(this.aLi)*this._getStyle(this.oUl)/100;else var c=(.5-(this.count+.5)/this.number)*this.oWrapperInner.width();var d=c-this.oldLeft;this._move(this.oldLeft,d,this.time,b)},_setBok:function(){this._setCenter(this.count),this._setSize(),this.bOk=!0},_rightClick:function(){this.bOk&&(this.bOk=!1,this.scale=1,this.infinite&&this._confirmCount(),this.count+=this.scrollNumber,this.infinite?this._centerUl("linear"):(this.count>this.aLi.length-1&&(this.count=this.aLi.length-1),this._centerUl("linear")),this.elem.trigger("spice.moveCenter-before",this),this.elem.trigger("spice.moveCenter-next",this))},_leftClick:function(){this.bOk&&(this.bOk=!1,this.scale=1,this.infinite&&this._confirmCount(),this.count-=this.scrollNumber,this.infinite?this._centerUl("linear"):(this.count<0&&(this.count=0),this._centerUl("linear")),this.elem.trigger("spice.moveCenter-before",this),this.elem.trigger("spice.moveCenter-prev",this))},_confirmUlLeft:function(a){return this.infinite?(a<=this.oWrapperInner.width()/2-(this.aLi.length-(this.number-1)/2-.5)*this.aLi.width()&&(a=this.oWrapperInner.width()/2-(this.aLi.length/3-(this.number-1)/2-.5+this.aLi.length/3)*this.aLi.width()),a>=0&&(a=-this.aLi.width()*this.aLi.length/3)):(this.oLeft.removeClass("is-disabled"),this.oRight.removeClass("is-disabled"),a>=(this.oWrapperInner.width()-this.aLi.width())/2&&(a=(this.oWrapperInner.width()-this.aLi.width())/2,this.timer&&clearInterval(this.timer),this.bOk=!0,this.oLeft.addClass("is-disabled")),a<=-(this.aLi.width()*(this.aLi.length-.5)-this.oWrapperInner.width()/2)&&(a=-(this.aLi.width()*(this.aLi.length-.5)-this.oWrapperInner.width()/2),this.timer&&clearInterval(this.timer),this.bOk=!0,this.oRight.addClass("is-disabled"))),a},_confirmCount:function(){this.count>2*this.aLi.length/3-1?(this.count=this.count-this.aLi.length/3,this._setBok()):this.count<=this.aLi.length/3-1&&(this.count=this.count+this.aLi.length/3,this._setBok())},_drag:function(b){function c(b){if(e.mobile)var c=b.originalEvent.changedTouches[0].pageX-f;else var c=b.pageX-f;c=e._confirmUlLeft(c),e.oUl.css("left",c),a.browser.msie&&a.browser.version<=8?e.oldLeft=c/e.oWrapperInner.width()*100:e.oldLeft=c,e.mobile?(e.speed=b.originalEvent.changedTouches[0].pageX-e.oldMoveClientX,e.oldMoveClientX=b.originalEvent.changedTouches[0].pageX,e.dis=b.originalEvent.changedTouches[0].pageX-e.downDis):(e.speed=b.pageX-e.oldMoveClientX,e.oldMoveClientX=b.pageX,e.dis=b.pageX-e.downDis),e._setSize()}function d(){if(e.elem.trigger("spice.moveCenter-before",e),e.scale=1,e.bOk=!1,Math.abs(e.speed)<=(1-Math.pow(1-1/Math.round(e.time/30),3))*e.oWrapperInner.width()/e.number){Math.abs(e.dis)>e.moveDis&&e.speed>0&&e.count==e.originCount&&(e.count--,!e.infinite&&e.count<0&&(e.count=0)),Math.abs(e.dis)>e.moveDis&&e.speed<0&&e.count==e.originCount&&(e.count++,!e.infinite&&e.count>e.aLi.length-1&&(e.count=e.aLi.length-1));var b=Math.abs(e.oUl.position().left+e.aLi.eq(e.count).position().left+e.aLi.width()/2-e.oWrapperInner.width()/2);e.scale=b/(e.oWrapperInner.width()*e.disScale)*5,e._centerUl("linear")}else clearInterval(e.timer),e.timer=setInterval(function(){if(e.speed*=.9,a.browser.msie&&a.browser.version<=8){var b=e._confirmUlLeft(e.oUl.position().left+e.speed);e.oUl.css("left",b),e.oldLeft=b/e.oWrapperInner.width()*100}else e.oldLeft+=e.speed,e.oldLeft=e._confirmUlLeft(e.oldLeft),e.oUl.css("left",e.oldLeft);if(e._setSize(),Math.abs(e.speed)<=(1-Math.pow(1-1/Math.round(e.time/30),3))*e.oWrapperInner.width()/e.number&&e.speed>=0){clearInterval(e.timer);var c=e.oUl.position().left+e.aLi.eq(e.count).position().left+e.aLi.width()/2-e.oWrapperInner.width()/2;c<=0?e._centerUl("ease-out"):(e.scale=1,e.count--,e.infinite?e._centerUl("ease-out"):(e.count<0&&(e.count=0),e._centerUl("ease-out")))}else if(Math.abs(e.speed)<=(1-Math.pow(1-1/Math.round(e.time/30),3))*e.oWrapperInner.width()/e.number&&e.speed<=0){clearInterval(e.timer);var c=e.oUl.position().left+e.aLi.eq(e.count).position().left+e.aLi.width()/2-e.oWrapperInner.width()/2;c>=0?e._centerUl("ease-out"):(e.scale=1,e.count++,e.infinite?e._centerUl("ease-out"):(e.count>e.aLi.length-1&&(e.count=e.aLi.length-1),e._centerUl("ease-out")))}},30);e.mobile?(a(document).off("touchmove",c),a(document).off("touchend",d)):(a(document).off("mousemove",c),a(document).off("mouseup",d)),e.oUl[0].releaseCapture&&e.oUl[0].releaseCapture()}var e=this;if(clearInterval(this.timer),this.originCount=this.count,this.speed=0,this.bOk=!0,e.mobile){var f=b.originalEvent.changedTouches[0].pageX-this.oUl.position().left;this.oldMoveClientX=b.originalEvent.changedTouches[0].pageX,this.downDis=b.originalEvent.changedTouches[0].pageX}else{var f=b.pageX-this.oUl.position().left;this.oldMoveClientX=b.pageX,this.downDis=b.pageX}return e.mobile?a(document).on("touchmove",c):a(document).on("mousemove",c),e.mobile?a(document).on("touchend",d):a(document).on("mouseup",d),b.preventDefault(),e.oUl[0].setCapture&&e.oUl[0].setCapture(),!1},_setMaxSize:function(){this.equalHeight?this.maxSize=this.originScaleWidth:this.maxSize=this.originScaleWidthFarther},_move:function(b,c,d,e){var f=this;this.bOk=!1;var g=Math.round(d*this.scale/30);if(g<=0)return this.bOk=!0,void f.elem.trigger("spice.moveCenter-after",f);var h=0;this.timer=setInterval(function(){if(h++,"linear"==e?(f.oldLeft+=c/g,a.browser.msie&&a.browser.version<=8?f.oUl.css("left",f.oldLeft+"%"):f.oUl.css("left",f.oldLeft)):"ease-out"==e&&(f.oldLeft=b+(1-Math.pow(1-h/g,3))*c,a.browser.msie&&a.browser.version<=8?f.oUl.css("left",f.oldLeft+"%"):f.oUl.css("left",f.oldLeft)),f.timer&&f._setSize(),h==g){if(clearInterval(f.timer),f.infinite)return f.count>=f.aLi.length-1-(f.number-1)/2&&(f.count=f.count-f.aLi.length/3,f._setBok()),f.count<=(f.number-1)/2&&(f.count=f.count+f.aLi.length/3,f._setBok()),f.bOk=!0,void f.elem.trigger("spice.moveCenter-after",f);f.count<=0?f.oLeft.addClass("is-disabled"):f.count>=f.aLi.length-1?f.oRight.addClass("is-disabled"):(f.oLeft.removeClass("is-disabled"),f.oRight.removeClass("is-disabled")),f.bOk=!0,f.elem.trigger("spice.moveCenter-after",f)}},30)},_getStyle:function(a){return parseFloat((a[0].currentStyle||getComputedStyle(a[0],!1)).width)},_browserRedirect:function(){var a=navigator.userAgent.toLowerCase(),b="ipad"==a.match(/ipad/i),c="iphone os"==a.match(/iphone os/i),d="midp"==a.match(/midp/i),e="rv:1.2.3.4"==a.match(/rv:1.2.3.4/i),f="ucweb"==a.match(/ucweb/i),g="android"==a.match(/android/i),h="windows ce"==a.match(/windows ce/i),i="windows mobile"==a.match(/windows mobile/i);this.mobile=!!(b||c||d||e||f||g||h||i)}},a.spice.moveCenter=b}(jQuery);