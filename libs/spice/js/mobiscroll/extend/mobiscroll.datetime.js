/*jslint eqeq: true, plusplus: true, undef: true, sloppy: true, vars: true, forin: true */
!function(a){var b=a.mobiscroll,c=new Date,d={startYear:c.getFullYear()-100,endYear:c.getFullYear()+1,shortYearCutoff:"+10",showNow:!1,stepHour:1,stepMinute:1,stepSecond:1,separator:" ",en:{dateFormat:"mm/dd/yy",dateOrder:"mmddy",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayText:"Day",hourText:"Hours",minuteText:"Minutes",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthText:"Month",secText:"Seconds",timeFormat:"hh:ii A",timeWheels:"hhiiA",yearText:"Year",ampmText:"&nbsp;",nowText:"Now"},zh:{dateFormat:"yy/mm/dd DD",dateOrder:"yymmdd",dayNames:["周日","周一","周二","周三","周四","周五","周六"],dayNamesShort:["日","一","二","三","四","五","六"],dayText:"日",hourText:"时",minuteText:"分",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthText:"月",secText:"秒",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"年",ampmText:"&nbsp;",nowText:"现在"},i18n:"zh"},e=function(c){function e(a,b,c){return void 0!==w[b]?+a[w[b]]:void 0!==c?c:F[x[b]]?F[x[b]]():x[b](F)}function f(a,b){return Math.floor(a/b)*b}function g(a){var b=a.getHours();return b=D&&b>=12?b-12:b,f(b,G)}function h(a){return f(a.getMinutes(),H)}function i(a){return f(a.getSeconds(),I)}function j(a){return C&&a.getHours()>11?1:0}function k(a){var b=e(a,"h",0);return new Date(e(a,"y"),e(a,"m"),e(a,"d",1),e(a,"a")?b+12:b,e(a,"i",0),e(a,"s",0))}var l,m=a(this),n={};if(m.is("input")){switch(m.attr("type")){case"date":l="yy-mm-dd";break;case"datetime":l="yy-mm-ddTHH:ii:ssZ";break;case"datetime-local":l="yy-mm-ddTHH:ii:ss";break;case"month":l="yy-mm",n.dateOrder="mmyy";break;case"time":l="HH:ii:ss"}var o=m.attr("min"),p=m.attr("max");o&&(n.minDate=b.parseDate(l,o)),p&&(n.maxDate=b.parseDate(l,p))}var q,r,s=a.extend({},d,n,c.settings),t=0,u=[],v=[],w={},x={y:"getFullYear",m:"getMonth",d:"getDate",h:g,i:h,s:i,a:j},y=s.preset,z=s[s.i18n].dateOrder,A=s[s.i18n].timeWheels,B=z.match(/D/),C=A.match(/a/i),D=A.match(/h/),E="datetime"==y?s[s.i18n].dateFormat+s.separator+s[s.i18n].timeFormat:"time"==y?s[s.i18n].timeFormat:s[s.i18n].dateFormat,F=new Date,G=s.stepHour,H=s.stepMinute,I=s.stepSecond,J=s.minDate||new Date(s.startYear,0,1),K=s.maxDate||new Date(s.endYear,11,31,23,59,59);if(c.settings=s,l=l||E,y.match(/date/i)){a.each(["y","m","d"],function(a,b){(q=z.search(new RegExp(b,"i")))>-1&&v.push({o:q,v:b})}),v.sort(function(a,b){return a.o>b.o?1:-1}),a.each(v,function(a,b){w[b.v]=a});var L={};for(r=0;r<3;r++)if(r==w.y){t++,L[s[s.i18n].yearText]={};var M=J.getFullYear(),N=K.getFullYear();for(q=M;q<=N;q++)L[s[s.i18n].yearText][q]=(z.match(/yy/i)?q:(q+"").substr(2,2))+s[s.i18n].yearText}else if(r==w.m)for(t++,L[s[s.i18n].monthText]={},q=0;q<12;q++){var O=z.replace(/[dy]/gi,"").replace(/mm/,q<9?"0"+(q+1):q+1).replace(/m/,q+1);L[s[s.i18n].monthText][q]=(O.match(/MM/)?O.replace(/MM/,'<span class="dw-mon">'+s[s.i18n].monthNames[q]+"</span>"):O.replace(/M/,'<span class="dw-mon">'+s[s.i18n].monthNamesShort[q]+"</span>"))+s[s.i18n].monthText}else if(r==w.d)for(t++,L[s[s.i18n].dayText]={},q=1;q<32;q++)L[s[s.i18n].dayText][q]=(z.match(/dd/i)&&q<10?"0"+q:q)+s[s.i18n].dayText;u.push(L)}if(y.match(/time/i)){for(v=[],a.each(["h","i","s","a"],function(a,b){(a=A.search(new RegExp(b,"i")))>-1&&v.push({o:a,v:b})}),v.sort(function(a,b){return a.o>b.o?1:-1}),a.each(v,function(a,b){w[b.v]=t+a}),L={},r=t;r<t+4;r++)if(r==w.h)for(t++,L[s[s.i18n].hourText]={},q=0;q<(D?12:24);q+=G)L[s[s.i18n].hourText][q]=D&&0==q?12:A.match(/hh/i)&&q<10?"0"+q:q;else if(r==w.i)for(t++,L[s[s.i18n].minuteText]={},q=0;q<60;q+=H)L[s[s.i18n].minuteText][q]=A.match(/ii/)&&q<10?"0"+q:q;else if(r==w.s)for(t++,L[s[s.i18n].secText]={},q=0;q<60;q+=I)L[s[s.i18n].secText][q]=A.match(/ss/)&&q<10?"0"+q:q;else if(r==w.a){t++;var P=A.match(/A/);L[s.ampmText]={0:P?"AM":"am",1:P?"PM":"pm"}}u.push(L)}return c.setDate=function(a,b,c,d){var e;for(e in w)this.temp[w[e]]=a[x[e]]?a[x[e]]():x[e](a);this.setValue(!0,b,c,d)},c.getDate=function(a){return k(a)},{button3Text:s.showNow?s.nowText:void 0,button3:s.showNow?function(){c.setDate(new Date,!1,.3,!0)}:void 0,wheels:u,onClose:function(){setTimeout(function(){m.blur()},0)},headerText:function(a){return b.formatDate(E,k(c.temp),s)},formatResult:function(a){return b.formatDate(l,k(a),s)},parseValue:function(a){var c,d=new Date,e=[];try{d=b.parseDate(l,a,s)}catch(a){}for(c in w)e[w[c]]=d[x[c]]?d[x[c]]():x[c](d);return e},validate:function(b,d){var g=c.temp,h={y:J.getFullYear(),m:0,d:1,h:0,i:0,s:0,a:0},i={y:K.getFullYear(),m:11,d:31,h:f(D?11:23,G),i:f(59,H),s:f(59,I),a:1},j=!0,k=!0;a.each(["y","m","d","a","h","i","s"],function(c,d){if(void 0!==w[d]){var f,l,m=h[d],n=i[d],o=31,p=e(g,d),q=a(".dw-ul",b).eq(w[d]);if("d"==d&&(f=e(g,"y"),l=e(g,"m"),o=32-new Date(f,l,32).getDate(),n=o,B&&a(".dw-li",q).each(function(){var b=a(this),c=b.data("val"),d=new Date(f,l,c).getDay(),e=z.replace(/[my]/gi,"").replace(/dd/,c<10?"0"+c:c).replace(/d/,c);a(".dw-i",b).html(e.match(/DD/)?e.replace(/DD/,'<span class="dw-day">'+s[s.i18n].dayNames[d]+"</span>"):e.replace(/D/,'<span class="dw-day">'+s[s.i18n].dayNamesShort[d]+"</span>"))})),j&&J&&(m=J[x[d]]?J[x[d]]():x[d](J)),k&&K&&(n=K[x[d]]?K[x[d]]():x[d](K)),"y"!=d){var r=a(".dw-li",q).index(a('.dw-li[data-val="'+m+'"]',q)),t=a(".dw-li",q).index(a('.dw-li[data-val="'+n+'"]',q));a(".dw-li",q).removeClass("dw-v").slice(r,t+1).addClass("dw-v"),"d"==d&&a(".dw-li",q).removeClass("dw-h").slice(o).addClass("dw-h")}if(p<m&&(p=m),p>n&&(p=n),j&&(j=p==m),k&&(k=p==n),s.invalid&&"d"==d){var u=[];if(s.invalid.dates&&a.each(s.invalid.dates,function(a,b){b.getFullYear()==f&&b.getMonth()==l&&u.push(b.getDate()-1)}),s.invalid.daysOfWeek){var v,y=new Date(f,l,1).getDay();a.each(s.invalid.daysOfWeek,function(a,b){for(v=b-y;v<o;v+=7)v>=0&&u.push(v)})}s.invalid.daysOfMonth&&a.each(s.invalid.daysOfMonth,function(a,b){b=(b+"").split("/"),b[1]?b[0]-1==l&&u.push(b[1]-1):u.push(b[0]-1)}),a.each(u,function(b,c){a(".dw-li",q).eq(c).removeClass("dw-v")})}g[w[d]]=p}})},methods:{getDate:function(b){var c=a(this).mobiscroll("getInst");if(c)return c.getDate(b?c.temp:c.values)},setDate:function(b,c,d,e){return void 0==c&&(c=!1),this.each(function(){var f=a(this).mobiscroll("getInst");f&&f.setDate(b,c,d,e)})}}}};a.each(["date","time","datetime"],function(a,c){b.presets[c]=e,b.presetShort(c)}),b.formatDate=function(b,c,e){if(!c)return null;var f,g=a.extend({},d,e),h=function(a){for(var c=0;f+1<b.length&&b.charAt(f+1)==a;)c++,f++;return c},i=function(a,b,c){var d=""+b;if(h(a))for(;d.length<c;)d="0"+d;return d},j=function(a,b,c,d){return h(a)?d[b]:c[b]},k="",l=!1;for(f=0;f<b.length;f++)if(l)"'"!=b.charAt(f)||h("'")?k+=b.charAt(f):l=!1;else switch(b.charAt(f)){case"d":k+=i("d",c.getDate(),2);break;case"D":k+=j("D",c.getDay(),g[g.i18n].dayNamesShort,g[g.i18n].dayNames);break;case"o":k+=i("o",(c.getTime()-new Date(c.getFullYear(),0,0).getTime())/864e5,3);break;case"m":k+=i("m",c.getMonth()+1,2);break;case"M":k+=j("M",c.getMonth(),g[g.i18n].monthNamesShort,g[g.i18n].monthNames);break;case"y":k+=h("y")?c.getFullYear():(c.getYear()%100<10?"0":"")+c.getYear()%100;break;case"h":var m=c.getHours();k+=i("h",m>12?m-12:0==m?12:m,2);break;case"H":k+=i("H",c.getHours(),2);break;case"i":k+=i("i",c.getMinutes(),2);break;case"s":k+=i("s",c.getSeconds(),2);break;case"a":k+=c.getHours()>11?"pm":"am";break;case"A":k+=c.getHours()>11?"PM":"AM";break;case"'":h("'")?k+="'":l=!0;break;default:k+=b.charAt(f)}return k},b.parseDate=function(b,c,e){var f=new Date;if(!b||!c)return f;c="object"==typeof c?c.toString():c+"";var g,h=a.extend({},d,e),i=h.shortYearCutoff,j=f.getFullYear(),k=f.getMonth()+1,l=f.getDate(),m=-1,n=f.getHours(),o=f.getMinutes(),p=0,q=-1,r=!1,s=function(a){var c=g+1<b.length&&b.charAt(g+1)==a;return c&&g++,c},t=function(a){s(a);var b="@"==a?14:"!"==a?20:"y"==a?4:"o"==a?3:2,d=new RegExp("^\\d{1,"+b+"}"),e=c.substr(w).match(d);return e?(w+=e[0].length,parseInt(e[0],10)):0},u=function(a,b,d){var e,f=s(a)?d:b;for(e=0;e<f.length;e++)if(c.substr(w,f[e].length).toLowerCase()==f[e].toLowerCase())return w+=f[e].length,e+1;return 0},v=function(){w++},w=0;for(g=0;g<b.length;g++)if(r)"'"!=b.charAt(g)||s("'")?v():r=!1;else switch(b.charAt(g)){case"d":l=t("d");break;case"D":u("D",h.dayNamesShort,h.dayNames);break;case"o":m=t("o");break;case"m":k=t("m");break;case"M":k=u("M",h[h.i18n].monthNamesShort,h[h.i18n].monthNames);break;case"y":j=t("y");break;case"H":n=t("H");break;case"h":n=t("h");break;case"i":o=t("i");break;case"s":p=t("s");break;case"a":q=u("a",["am","pm"],["am","pm"])-1;break;case"A":q=u("A",["am","pm"],["am","pm"])-1;break;case"'":s("'")?v():r=!0;break;default:v()}if(j<100&&(j+=(new Date).getFullYear()-(new Date).getFullYear()%100+(j<=("string"!=typeof i?i:(new Date).getFullYear()%100+parseInt(i,10))?0:-100)),m>-1)for(k=1,l=m;;){var x=32-new Date(j,k-1,32).getDate();if(l<=x)break;k++,l-=x}n=-1==q?n:q&&n<12?n+12:q||12!=n?n:0;var y=new Date(j,k-1,l,n,o,p);if(y.getFullYear()!=j||y.getMonth()+1!=k||y.getDate()!=l)throw"Invalid date";return y}}(jQuery);