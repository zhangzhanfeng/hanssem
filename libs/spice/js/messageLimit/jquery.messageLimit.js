!function(a){"use strict";function b(b,c){if(!b||a.isPlainObject(b))return!1;var d=[];return a(b).each(function(b,f){var g=a(f),h=g.data("spice.MessageLimit");h||g.data("spice.MessageLimit",h=new e(g,c)),d.push(h)}),d}var c={counterClass:"events-messageCounter",isCounter:!0,maxCount:150,minCount:0,isFullwidth:!1,isCutoff:!0,keyUpCheck:!0,maxClass:"is-maxLen",minClass:"is-minLen",callBackKeyUp:null,blurCheck:!0,errorClass:"is-error",messageClass:"help-block",maxMessage:"评论不能大于30字",minMessage:"评论不能小于10字",callBackBlur:null},d={getLength:function(b,c){return b?a.spice.getStringLength(c.val()):c.val().length},setLimit:function(a){var b,c=a.elem.find("textarea"),e=a.opt.maxCount;(b=d.getLength(a.opt.isFullwidth,c))>e&&c.val(c.val().substring(0,e))},setCount:function(a){var b,c=a.elem.find("textarea"),e=a.elem.find("."+a.opt.counterClass),f=a.opt.isCounter,g=a.opt.maxCount;b=d.getLength(a.opt.isFullwidth,c),f?e.html(g-b<0?0:g-b):e.html(b)},valCheck:function(a){var b,c,e=a.elem.find("textarea"),f=a.opt.maxCount,g=a.opt.minCount;return b=d.getLength(a.opt.isFullwidth,e),c=b>f&&f>0?"isMax":b<g&&g>0?"isMin":"isPermited",{len:b,state:c}},errorCheck:function(a){var b,c=a.elem.find("textarea"),e=a.elem.find("."+a.opt.messageClass),f="",g=a.opt.maxCount,h=a.opt.minCount;b=d.getLength(a.opt.isFullwidth,c),b>g&&(f=a.opt.maxMessage),b<h&&(f=a.opt.minMessage),""==f?a.elem.removeClass(a.opt.errorClass):(a.elem.addClass(a.opt.errorClass),e.html(f))}},e=function(b,d){var e=this;e.opt=a.extend({},c,d),e.elem=b,e.init()};e.prototype={init:function(){var b=this,c=b.opt,e=b.elem.find("textarea"),f="maxLength"in document.createElement("textarea");c.maxCount>0&&c.isCounter&&b.elem.find("."+c.counterClass).html(c.maxCount),c.maxCount>0&&c.isCutoff&&f&&e.attr({maxLength:c.maxCount}),e.on({"keypress.MessageLimit":function(){c.maxCount>0&&c.isCutoff&&!f&&d.setLimit(b)},"keyup.MessageLimit input.MessageLimit":function(){var e=d.valCheck(b);if(c.maxCount>0&&(c.isCutoff&&!f&&d.setLimit(b),d.setCount(b)),c.keyUpCheck)switch(e.state){case"isMax":b.elem.addClass(c.maxClass).removeClass(c.minClass);break;case"isMin":b.elem.addClass(c.minClass).removeClass(c.maxClass);break;default:b.elem.removeClass(c.maxClass+" "+c.minClass)}a.isFunction(c.callBackKeyUp)&&c.callBackKeyUp(e.len,b)},"blur.MessageLimit":function(){var e=d.valCheck(b);c.blurCheck&&d.errorCheck(b),d.setCount(b),a.isFunction(c.callBackBlur)&&c.callBackBlur(e.len,b)}})}},a.spice.MessageLimit=b}(jQuery);