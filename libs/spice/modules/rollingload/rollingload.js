!function(a){"use strict";function b(b,c){if(!b||a.isPlainObject(b))return!1;var d=[];return a(b).each(function(b,f){var g=a(f),h=g.data("spice.rollingload");h&&h.destroy(),g.data("spice.rollingload",h=new e(g,c,a.spice.rollingload.fnIndex)),a.spice.rollingload.fnIndex+=1,d.push(h)}),d}var c={contents:null,url:"",dataTerm:"",pageName:"",curPageName:"spice-data-cur-page",maxPageName:"spice-data-max-page",dataTermName:"spice-data-term",zoneClass:"spice-rollingload-zone",markClass:"spice-rollingload-mark",scrollArea:"window",num:0,buildHtml:null,callBack:null,htmlTemplate:""},d={checkMask:function(b,c,d){b+1>c&&a("."+d.opt.markClass).find(">*").hide()}},e=function(b,d,e){var f=this;f.opt=a.extend({},c,d),f.opt.fnIndex=e,f.elem=b,f.init()};e.prototype={init:function(){var b=this,c=b.elem,e=b.opt;c.data("spice.rollingloadIndex",e.fnIndex);var f=a("window"==e.scrollArea?window:"."+e.scrollArea),g=c.find("."+e.zoneClass),h=c.find("."+e.markClass);b.isRequesting=1,f.off("scroll.rollingload"+e.fnIndex).on("scroll.rollingload"+e.fnIndex,function(){var i=a(this);if(i.scrollTop()+i.height()>h.offset().top-e.num&&b.isRequesting){b.isRequesting=0;var j={},k=c.attr(e.dataTermName),l=c.attr(e.curPageName),m=c.attr(e.maxPageName);if(l&&m){if(++l>m)return;e.pageName&&(j[e.pageName]=l)}if(e.url){k=a.parseJSON(k),(e.dataTerm||k)&&(j=a.extend({},j,k||e.dataTerm));var n="",o=a.spice.syncXhr(e.url,j)}else var n="",o=e.contents;if(!o)return;if(e.buildHtml&&a.isFunction(e.buildHtml))if(b.curPage=l,b.maxPage=m,e.htmlTemplate){var p=Handlebars.compile(e.htmlTemplate);n=e.buildHtml(o,b,p)}else n=e.buildHtml(o,b);else n=o;g.append(n),l&&m?(d.checkMask(l,m,b),c.attr(e.curPageName,l)):(b.curPage=1,b.maxPage=1,d.checkMask(1,1,b)),e.callBack&&a.isFunction(e.callBack)&&e.callBack(o,b),b.isRequesting=1,i.scrollTop()+i.height()>h.offset().top-e.num&&f.trigger("scroll.rollingload"+e.fnIndex)}}).trigger("scroll.rollingload"+e.fnIndex)},destroy:function(){var b=this,c=b.elem,d=b.opt,e=c.data("spice.rollingloadIndex");a("window"==d.scrollArea?window:"."+d.scrollArea).off("scroll.rollingload"+e),c.removeData("spice.rollingload")},refresh:function(b,c){var d=this,e=d.elem,f=d.opt;b&&c?(d.curPage=b,d.maxPage=c,e.attr(f.curPageName,b),e.attr(f.maxPageName,c)):(delete d.curPage,delete d.maxPage),d.isRequesting=1,a("."+f.markClass).find(">*").removeAttr("style")}},a.spice.rollingload=b,a.spice.rollingload.fnIndex=0}(jQuery);